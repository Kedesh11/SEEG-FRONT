import{h as H,r as t,j as e,B as m,C as G,e as J,L as K,b as i}from"./index-Dt07UTka.js";import{A as Q}from"./AdminLayout-Dn56Iv11.js";import{I as n}from"./input-Bw9vQiwZ.js";import{D as W,b as X,c as Y,d as Z,e as $}from"./dialog-DETbZ713.js";import{A as ee,b as se,c as ae,d as re,f as le,g as te,h as ie}from"./alert-dialog-DaOPzWw8.js";import{L as c}from"./label-5-3zOpNH.js";import{B as ne}from"./badge-BL2mfjTD.js";import{S as D,a as E,b as A,c as k,d as v}from"./SafeSelect-CA0q4OzQ.js";import{u as ce}from"./useBackendAuth-DCuf5k9n.js";import{l as oe,d as de}from"./users-Bp6FZJo5.js";import{P as me}from"./plus-Cq7fvgYR.js";import{S as ue}from"./search-CrW7gRAG.js";import{U as he}from"./user-ix4zyo1H.js";import{T as xe}from"./trash-2-BDEO4a2-.js";import"./separator-CPOmk9ej.js";import"./index-CnKgKWfo.js";import"./Combination-aU0zapuW.js";import"./index-Cr6IkeUt.js";import"./index-BdQq_4o_.js";import"./index-lOYlu7e4.js";import"./index-CUAMUldx.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=H("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),U=[{value:"admin",label:"Admin"},{value:"recruiter",label:"Recruteur"},{value:"observer",label:"Observateur"},{value:"candidat",label:"Candidat"}];function Be(){const[N,L]=t.useState([]),[T,g]=t.useState(!0),[b,y]=t.useState(null),[p,z]=t.useState(""),[u,F]=t.useState("all"),[R,o]=t.useState(!1),[a,l]=t.useState(null),[S,C]=t.useState(!1),[B,f]=t.useState(!1),[w,_]=t.useState(!1),{adminCreateUser:M}=ce(),h=t.useCallback(async()=>{g(!0),y(null);try{const{items:s}=await oe({q:p||void 0,role:u!=="all"?u:void 0});L(s)}catch{y("Erreur de chargement des utilisateurs")}finally{g(!1)}},[p,u]);t.useEffect(()=>{h()},[h]);const j=()=>{l(null)},O=()=>{l({email:"",role:"observer"}),o(!0)},P=s=>{l({...s}),o(!0)},q=s=>{l({...s}),f(!0)},I=async()=>{if(a){C(!0);try{const s={email:a.email||void 0,first_name:a.first_name||void 0,last_name:a.last_name||void 0,phone:a.phone||void 0,matricule:a.matricule??void 0,date_of_birth:a.date_of_birth||void 0,role:a.role||void 0},r=a.role==="recruiter"||a.role==="observer"||a.role==="admin";if(a.id)i.info("La mise à jour des utilisateurs sera bientôt disponible.");else{if(!a.role){i.error("Veuillez choisir un rôle");return}if(r)try{await M({email:String(s.email||""),password:void 0,first_name:String(s.first_name||""),last_name:String(s.last_name||""),phone:s.phone?String(s.phone):void 0,matricule:s.matricule?Number(s.matricule):void 0,role:a.role}),i.success("Utilisateur backend créé")}catch(d){const x=d instanceof Error?d.message:"Erreur création backend";i.error(x);return}else{i.info("La création de candidats doit se faire via le parcours d'inscription.");return}}o(!1),j(),await h()}catch(s){const r=s instanceof Error?s.message:"Erreur lors de l'enregistrement";i.error(r)}finally{C(!1)}}},V=async()=>{if(a!=null&&a.id){_(!0);try{if(!await de(a.id))throw new Error("Suppression backend non confirmée");i.success("Utilisateur supprimé"),f(!1),j(),await h()}catch(s){const r=s instanceof Error?s.message:"Erreur lors de la suppression";i.error(r)}finally{_(!1)}}};return e.jsxs(Q,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Gestion des utilisateurs"}),e.jsx("p",{className:"text-muted-foreground",children:"Créer, modifier, supprimer et rechercher des utilisateurs"})]}),e.jsxs(m,{onClick:O,className:"gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Nouvel utilisateur"]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ue,{className:"absolute left-3 top-3 w-4 h-4 text-muted-foreground"}),e.jsx(n,{placeholder:"Rechercher (nom, email, matricule, téléphone)",className:"pl-10",value:p,onChange:s=>z(s.target.value)})]}),e.jsxs(D,{value:u,onValueChange:F,children:[e.jsx(E,{className:"w-[180px]",children:e.jsx(A,{placeholder:"Rôle"})}),e.jsxs(k,{children:[e.jsx(v,{value:"all",children:"Tous les rôles"}),U.map(s=>e.jsx(v,{value:s.value,children:s.label},s.value))]})]})]}),e.jsx(G,{children:e.jsx(J,{className:"p-0",children:T?e.jsxs("div",{className:"flex items-center justify-center py-16 text-muted-foreground",children:[e.jsx(K,{className:"w-5 h-5 animate-spin mr-2"})," Chargement..."]}):b?e.jsx("div",{className:"p-6 text-red-600",children:b}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b bg-muted/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Utilisateur"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Email"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Rôle"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Matricule"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Téléphone"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:N.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/20",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(he,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{children:e.jsxs("div",{className:"font-medium",children:[s.first_name," ",s.last_name]})})]})}),e.jsx("td",{className:"p-3 text-sm",children:s.email}),e.jsx("td",{className:"p-3",children:e.jsx(ne,{variant:"secondary",children:s.role})}),e.jsx("td",{className:"p-3 text-sm",children:s.matricule||"-"}),e.jsx("td",{className:"p-3 text-sm",children:s.phone||"-"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>P(s),children:[e.jsx(pe,{className:"w-4 h-4"})," Editer"]}),e.jsxs(m,{variant:"destructive",size:"sm",className:"gap-1",onClick:()=>q(s),children:[e.jsx(xe,{className:"w-4 h-4"})," Supprimer"]})]})})]},s.id||s.email))})]}),N.length===0&&e.jsx("div",{className:"py-16 text-center text-muted-foreground",children:"Aucun utilisateur"})]})})}),e.jsx(W,{open:R,onOpenChange:s=>{o(s),s||j()},children:e.jsxs(X,{className:"max-w-xl",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:a!=null&&a.id?"Modifier l'utilisateur":"Créer un utilisateur"}),e.jsx($,{children:a!=null&&a.id?"Modifiez les informations de l'utilisateur ci-dessous.":"Créez un nouvel utilisateur en remplissant les informations ci-dessous."})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Email"}),e.jsx(n,{type:"email",required:!0,value:(a==null?void 0:a.email)||"",onChange:s=>l(r=>({...r,email:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Rôle"}),e.jsxs(D,{value:(a==null?void 0:a.role)||"observer",onValueChange:s=>l(r=>({...r,role:s})),children:[e.jsx(E,{children:e.jsx(A,{placeholder:"Sélectionner un rôle"})}),e.jsx(k,{children:U.map(s=>e.jsx(v,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Prénom"}),e.jsx(n,{required:!0,value:(a==null?void 0:a.first_name)||"",onChange:s=>l(r=>({...r,first_name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Nom"}),e.jsx(n,{required:!0,value:(a==null?void 0:a.last_name)||"",onChange:s=>l(r=>({...r,last_name:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Matricule"}),e.jsx(n,{value:(a==null?void 0:a.matricule)??"",onChange:s=>l(r=>({...r,matricule:(()=>{const d=s.target.value.trim(),x=Number(d);return d===""||Number.isNaN(x)?void 0:x})()}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Téléphone"}),e.jsx(n,{value:(a==null?void 0:a.phone)||"",onChange:s=>l(r=>({...r,phone:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Date de naissance"}),e.jsx(n,{type:"date",value:(a==null?void 0:a.date_of_birth)||"",onChange:s=>l(r=>({...r,date_of_birth:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Sexe"}),e.jsx(n,{placeholder:"M/F/autre",value:(a==null?void 0:a.sexe)||"",onChange:s=>l(r=>({...r,sexe:s.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Annuler"}),e.jsx(m,{type:"submit",disabled:S,children:S?"Enregistrement...":"Enregistrer"})]})]})]})}),e.jsx(ee,{open:B,onOpenChange:f,children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsx(re,{children:"Supprimer cet utilisateur ?"})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cette action est irréversible."}),e.jsxs(le,{children:[e.jsx(te,{children:"Annuler"}),e.jsx(ie,{onClick:V,disabled:w,children:w?"Suppression...":"Supprimer"})]})]})})]})}export{Be as default};
