import{l as L,u as R,j as e,B as u,g as A,A as z,L as E,C as b,c as I,d as B,e as T}from"./index-Dt07UTka.js";import{R as N}from"./RecruiterLayout-CzqFpArC.js";import{B as v}from"./badge-BL2mfjTD.js";import{e as P}from"./useApplications-Dtoeuj7w.js";import{u as F}from"./useSynthesisData-1xqSxzoc.js";import{U as y}from"./users-BSixSwM-.js";import{C as M}from"./calendar-BKvS43I6.js";import{E as H}from"./eye-BrJFRD8F.js";import"./sidebar-DQHe9abK.js";import"./input-Bw9vQiwZ.js";import"./separator-CPOmk9ej.js";import"./index-CnKgKWfo.js";import"./Combination-aU0zapuW.js";import"./layout-dashboard-CftRPHET.js";import"./brain-BM1gby9g.js";import"./briefcase-DGZDCsL0.js";import"./user-ix4zyo1H.js";import"./log-out-C2CngwNs.js";import"./useQuery-BeOx6H6z.js";import"./useMutation-DLLhhcgk.js";const J=({applicationId:a})=>{const{synthesisData:i}=F(a);return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground",children:"Score"}),e.jsxs(v,{variant:"outline",className:"text-xs sm:text-sm",children:[Math.round(i.globalScore),"%"]})]})},w=a=>!a||a.includes(" ")||a.includes("-")||a.includes("@")||a.includes(":")?"candidature":["candidature","incubation","embauche","refuse","entretien_programme"].includes(a.toLowerCase())?a.toLowerCase():"candidature",O=a=>{switch(w(a)){case"candidature":return"Candidats";case"incubation":return"Incubés";case"embauche":return"Engagés";case"refuse":return"Refusés";case"entretien_programme":return"Entretiens";default:return"Candidats"}};function me(){var g,j;const{id:a}=L(),i=R(),{applications:h,isLoading:C,error:p}=P(a),f=s=>{if(!s)return"";const t=new Date(s);return isNaN(t.getTime())?"":t.toISOString().split("T")[0]},S=s=>{if(!s)return"Non définie";const t=new Date(s);return isNaN(t.getTime())?"Date invalide":t.toLocaleDateString("fr-FR")},x=h.map(s=>{var n,l,o,c,m,d;console.log("Application data received in JobPipeline:",s),console.log("Raw interview_date from DB:",s.interview_date);const t=w(s.status),r={id:s.id,name:`${((n=s.users)==null?void 0:n.first_name)||""} ${((l=s.users)==null?void 0:l.last_name)||""}`.trim(),statusLabel:O(s.status),phone:((o=s.users)==null?void 0:o.phone)||"Non fourni",experience:"",status:t,score:0,applicationDate:f(s.created_at),email:((c=s.users)==null?void 0:c.email)||"",interviewDate:s.interview_date,gender:(m=s.users)==null?void 0:m.sexe,birthDate:f((d=s.users)==null?void 0:d.date_of_birth)};return s.interview_date&&console.log("🔍 Interview date for",r.name,":",s.interview_date),r}),D=((j=(g=h[0])==null?void 0:g.job_offers)==null?void 0:j.title)||"Offre d'emploi",_=s=>s==="candidature"?x.filter(t=>t.status==="candidature"||t.status==="entretien_programme"):x.filter(t=>t.status===s),k=[{key:"candidature",label:"Candidats",color:"border-blue-500"},{key:"incubation",label:"Incubés",color:"border-warning"},{key:"embauche",label:"Engagés",color:"border-success"},{key:"refuse",label:"Refusés",color:"border-red-500"}],$=s=>{const t=a,r=t?`?jobId=${t}`:"";console.log(`Navigating to analysis for candidate ${s} with job ${t}`),i(`/recruiter/candidates/${s}/analysis${r}`)};return p?e.jsx(N,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-red-500 mb-4",children:["Erreur lors du chargement: ",p.message]}),e.jsx(u,{variant:"outline",onClick:()=>window.location.reload(),children:"Réessayer"})]})})}):e.jsx(N,{children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-6 lg:py-8",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex items-center gap-3 sm:gap-4 mb-3 sm:mb-4",children:e.jsx(A,{to:"/recruiter/jobs",children:e.jsxs(u,{variant:"outline",size:"sm",className:"text-xs sm:text-sm",children:[e.jsx(z,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Retour aux postes"}),e.jsx("span",{className:"sm:hidden",children:"Retour"})]})})}),e.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-foreground mb-2 break-words",children:["Pipeline pour : ",D]}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base text-muted-foreground",children:"Gérez le flux de tous les candidats pour ce poste de manière visuelle et interactive"})]}),C?e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center py-8 sm:py-12 gap-2 sm:gap-4",children:[e.jsx(E,{className:"w-6 h-6 sm:w-8 sm:h-8 animate-spin text-primary"}),e.jsx("span",{className:"text-sm sm:text-base",children:"Chargement du pipeline..."})]}):x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:e.jsx(y,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucune candidature trouvée"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Il n'y a actuellement aucune candidature pour cette offre d'emploi."}),e.jsx(u,{variant:"outline",onClick:()=>window.location.reload(),children:"Actualiser"})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-4 sm:gap-6",children:k.map(s=>{const t=_(s.key);return e.jsx("div",{children:e.jsxs(b,{className:`border-t-4 ${s.color} h-full`,children:[e.jsx(I,{className:"pb-2 sm:pb-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx(B,{className:"text-base sm:text-lg font-semibold truncate",children:s.label}),e.jsx(v,{variant:"secondary",className:"text-xs sm:text-sm flex-shrink-0",children:t.length})]})}),e.jsxs(T,{className:"space-y-3 sm:space-y-4 min-h-[300px] sm:min-h-[400px]",children:[t.map(r=>e.jsx(b,{className:"p-3 sm:p-4 hover:shadow-medium transition-all cursor-pointer group",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm sm:text-base font-semibold text-foreground group-hover:text-primary transition-colors line-clamp-1",children:r.name}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground truncate",title:r.email,children:r.email}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:r.phone}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Candidature : ",S(r.applicationDate)]}),r.status==="entretien_programme"&&r.interviewDate&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-600 whitespace-nowrap",children:[e.jsx(M,{className:"w-3 h-3 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:["Entretien : ",(()=>{const n=new Date(r.interviewDate),l=n.getDate().toString().padStart(2,"0"),o=(n.getMonth()+1).toString().padStart(2,"0"),c=n.getFullYear(),m=n.getHours().toString().padStart(2,"0"),d=n.getMinutes().toString().padStart(2,"0");return`${l}/${o}/${c} à ${m}:${d}`})()]})]})]}),r.status!=="candidature"&&r.status!=="entretien_programme"&&e.jsx(J,{applicationId:r.id}),e.jsxs(u,{size:"sm",className:"w-full gap-1 sm:gap-2 text-xs sm:text-sm",variant:"hero",onClick:()=>$(r.id),children:[e.jsx(H,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Analyser"}),e.jsx("span",{className:"sm:hidden",children:"Voir"})]})]})},r.id)),t.length===0&&e.jsxs("div",{className:"text-center py-6 sm:py-8 text-muted-foreground",children:[e.jsx(y,{className:"w-6 h-6 sm:w-8 sm:h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs sm:text-sm",children:"Aucun candidat"})]})]})]})},s.key)})})})]})})}export{me as default};
