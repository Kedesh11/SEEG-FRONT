import{r as e,m as g,aq as h,ar as E,as as S,at as _,au as b}from"./index-Dt07UTka.js";const p="hcm_access_token";function M(){const[n,u]=e.useState(()=>{try{return localStorage.getItem(p)}catch{return null}}),[o,c]=e.useState(null),[i,l]=e.useState(!1),[f,r]=e.useState(null),t=e.useCallback(async()=>{if(!n){c(null);return}try{l(!0),r(null);const a=await g();c(a)}catch{c(null),r("Impossible de récupérer le profil")}finally{l(!1)}},[n]);e.useEffect(()=>{t()},[t]);const k=e.useCallback(async(a,C)=>{try{l(!0),r(null);const s=await h(a,C);return s!=null&&s.access_token?(E(s.access_token),u(s.access_token),await t(),!0):(r("Identifiants invalides"),!1)}catch{return r("Erreur de connexion"),!1}finally{l(!1)}},[t]),y=e.useCallback(()=>{try{S()}catch{}u(null),c(null)},[]),m=e.useCallback(async()=>_(),[]),d=e.useCallback(async a=>b(a),[]);return e.useMemo(()=>({token:n,user:o,loading:i,error:f,login:k,logout:y,refreshMe:t,verifyMatricule:m,adminCreateUser:d}),[n,o,i,f,k,y,t,m,d])}export{M as u};
