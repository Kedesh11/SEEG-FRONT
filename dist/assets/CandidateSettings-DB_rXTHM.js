import{h as se,a as te,u as ae,k as ie,r as s,s as c,j as e,C as S,c as C,d as E,e as P,B as Y}from"./index-Dt07UTka.js";import{C as oe}from"./CandidateLayout-BG-L92lp.js";import{L as i}from"./label-5-3zOpNH.js";import{I as n}from"./input-Bw9vQiwZ.js";import{S as ne,a as de,b as le,c as ce,d as $}from"./SafeSelect-CA0q4OzQ.js";import{T as me}from"./textarea-DZPoKpSZ.js";import{F as pe}from"./spinner-DybE6_pM.js";import{U as ue}from"./user-ix4zyo1H.js";import{B as he}from"./briefcase-DGZDCsL0.js";import{E as J}from"./eye-off-CYo70Vkr.js";import{E as Q}from"./eye-BrJFRD8F.js";import"./sidebar-DQHe9abK.js";import"./separator-CPOmk9ej.js";import"./index-CnKgKWfo.js";import"./Combination-aU0zapuW.js";import"./badge-BL2mfjTD.js";import"./index-lOYlu7e4.js";import"./index-DmmJ9r5k.js";import"./chevron-right-BfnH_zY5.js";import"./index-CUAMUldx.js";import"./popover-YAsM8h-6.js";import"./fr-CfdXjsD4.js";import"./en-US-Dy1UnLtf.js";import"./Layout-mbh2DWpt.js";import"./launchGate-DNqG8lWI.js";import"./useQuery-BeOx6H6z.js";import"./useMutation-DLLhhcgk.js";import"./formatDistanceToNow-2oA28mCp.js";import"./endOfMonth-CkNiGKnp.js";import"./log-out-C2CngwNs.js";import"./select-B2MghH9c.js";import"./index-Cr6IkeUt.js";import"./index-BdQq_4o_.js";import"./useApplications-Dtoeuj7w.js";import"./useJobOffers-BrDiClz1.js";import"./metierQuestions-BOW-dpJS.js";import"./format-BbOC2X4i.js";import"./file-text-XdKEpMSd.js";import"./map-pin-YC5vFqhh.js";import"./calendar-BKvS43I6.js";import"./job-card-nIfnLekR.js";import"./applicationUtils-GIDm11E_.js";import"./layout-grid-0bM3oqzR.js";import"./list-BNYgf13m.js";import"./useDocuments-BoCfcbm3.js";import"./plus-Cq7fvgYR.js";import"./circle-check-big-DK0TIh3k.js";import"./users-BSixSwM-.js";import"./circle-x-Duq0gYSF.js";import"./avatar-NQv1LJOP.js";import"./index-D3cVrz6_.js";import"./users-Bp6FZJo5.js";import"./square-pen-BJrgxhp9.js";import"./save-Dp_vy41W.js";import"./mail-DxVkVQXW.js";import"./phone-Bri8K_yJ.js";import"./Chatbot-6VsFwavh.js";import"./send-ekdqg9ff.js";import"./progress-B636bzhk.js";import"./circle-alert-BJk9C7zG.js";import"./banknote-B5ExLXZp.js";import"./clock-BVvfuB3Z.js";import"./ApplicationForm-BNFWNAwd.js";import"./checkbox-i6IZ-y8B.js";import"./search-CrW7gRAG.js";import"./filter-nUhWB70p.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=se("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);function _r(){const{user:t,isLoading:p}=te(),u=!!t,h=ae(),{toast:d}=ie(),[b,_]=s.useState(""),[F,k]=s.useState(""),[m,A]=s.useState(""),[L,T]=s.useState(""),[D,I]=s.useState(!1),[M,q]=s.useState(!1),[x,W]=s.useState(!1),[f,X]=s.useState(!1),[g,B]=s.useState(""),[j,V]=s.useState(""),[v,U]=s.useState(""),[w,z]=s.useState(""),[N,G]=s.useState(""),[y,O]=s.useState(""),[Z,R]=s.useState(!1);s.useEffect(()=>{!p&&!u&&h("/candidate/login")},[u,p,h]);const H=s.useCallback(async()=>{var r;if(t!=null&&t.id)try{R(!0);const{data:a,error:o}=await c.from("users").select("phone").eq("id",t.id).maybeSingle();o?console.warn("Erreur lors du chargement des données utilisateur:",o):a&&O(a.phone||"");const{data:l,error:K}=await c.from("candidate_profiles").select("gender, birth_date, current_position, years_experience, address").eq("user_id",t.id).maybeSingle();K?console.warn("Erreur lors du chargement du profil candidat:",K):l&&(B(l.gender||""),V(l.birth_date||""),U(l.current_position||""),z(((r=l.years_experience)==null?void 0:r.toString())||""),G(l.address||""))}catch(a){console.error("Erreur lors du chargement du profil:",a)}finally{R(!1)}},[t==null?void 0:t.id]);if(s.useEffect(()=>{if(!t)return;const r=t.user_metadata||{};_(r.first_name??""),k(r.last_name??""),H()},[t,H]),p)return e.jsx(pe,{text:"Chargement des paramètres..."});if(!u)return null;const ee=async()=>{try{I(!0);const{error:r}=await c.auth.updateUser({data:{first_name:b,last_name:F}});if(r)throw r;if(y.trim()){const{error:o}=await c.from("users").update({phone:y.trim()}).eq("id",t.id);o&&console.warn("Erreur lors de la mise à jour du téléphone:",o)}const a={user_id:t.id};if(g&&(a.gender=g),j&&(a.birth_date=j),v&&(a.current_position=v),w&&(a.years_experience=w),N&&(a.address=N),Object.keys(a).length>1){const{error:o}=await c.from("candidate_profiles").upsert(a,{onConflict:"user_id"});if(o){console.error("Erreur lors de la mise à jour du profil candidat:",o),d({variant:"destructive",title:"Erreur",description:`Erreur lors de la sauvegarde du profil détaillé: ${o.message}`});return}}d({title:"Profil mis à jour",description:"Toutes vos informations ont été enregistrées."}),h("/candidate/dashboard")}catch(r){const a=r instanceof Error?r.message:"Échec de la mise à jour";d({variant:"destructive",title:"Erreur",description:a})}finally{I(!1)}},re=async()=>{if(!m||m.length<6){d({variant:"destructive",title:"Mot de passe invalide",description:"Au moins 6 caractères."});return}if(m!==L){d({variant:"destructive",title:"Incohérence",description:"Les mots de passe ne correspondent pas."});return}try{q(!0);const{error:r}=await c.auth.updateUser({password:m});if(r)throw r;A(""),T(""),d({title:"Mot de passe modifié",description:"Votre mot de passe a été mis à jour."})}catch(r){const a=r instanceof Error?r.message:"Échec du changement de mot de passe";d({variant:"destructive",title:"Erreur",description:a})}finally{q(!1)}};return e.jsx(oe,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-bold mb-2",children:"Paramètres"}),e.jsx("p",{className:"text-sm sm:text-base lg:text-lg text-muted-foreground",children:"Gérez vos informations de compte et votre mot de passe"})]}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-5 h-5"}),"Informations du compte"]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"firstName",children:"Prénom"}),e.jsx(n,{id:"firstName",value:b,onChange:r=>_(r.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"lastName",children:"Nom"}),e.jsx(n,{id:"lastName",value:F,onChange:r=>k(r.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"phone",children:"Téléphone"}),e.jsx(n,{id:"phone",type:"tel",value:y,onChange:r=>O(r.target.value),placeholder:"Ex: +241 01 23 45 67"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(n,{id:"email",value:(t==null?void 0:t.email)||"",readOnly:!0})]})]})]})]}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),"Profil Candidat"]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"gender",children:"Sexe"}),e.jsxs(ne,{value:g,onValueChange:B,children:[e.jsx(de,{children:e.jsx(le,{placeholder:"Sélectionnez votre sexe"})}),e.jsxs(ce,{children:[e.jsx($,{value:"homme",children:"Homme"}),e.jsx($,{value:"femme",children:"Femme"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"birthDate",children:"Date de naissance"}),e.jsx(n,{id:"birthDate",type:"date",value:j,onChange:r=>V(r.target.value),max:"2007-12-31"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"currentPosition",children:"Poste actuel"}),e.jsx(n,{id:"currentPosition",value:v,onChange:r=>U(r.target.value),placeholder:"Ex: Technicien réseau"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"yearsExperience",children:"Années d'expérience à la SEEG ou secteur similaire"}),e.jsx(n,{id:"yearsExperience",type:"number",min:"0",max:"60",value:w,onChange:r=>z(r.target.value),placeholder:"Ex: 5"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"address",children:"Adresse"}),e.jsx(me,{id:"address",value:N,onChange:r=>G(r.target.value),placeholder:"Votre adresse complète",rows:2})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Y,{onClick:ee,disabled:D||Z,children:D?"Enregistrement...":"Enregistrer"})})]})]}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),"Sécurité"]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"newPassword",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"newPassword",type:x?"text":"password",value:m,onChange:r=>A(r.target.value),className:"pr-10"}),e.jsx("button",{type:"button","aria-label":x?"Masquer le mot de passe":"Afficher le mot de passe",onClick:()=>W(r=>!r),className:"absolute right-3 top-2.5 text-muted-foreground hover:text-foreground",children:x?e.jsx(J,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"confirmPassword",children:"Confirmer le mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"confirmPassword",type:f?"text":"password",value:L,onChange:r=>T(r.target.value),className:"pr-10"}),e.jsx("button",{type:"button","aria-label":f?"Masquer le mot de passe":"Afficher le mot de passe",onClick:()=>X(r=>!r),className:"absolute right-3 top-2.5 text-muted-foreground hover:text-foreground",children:f?e.jsx(J,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(Y,{variant:"outline",onClick:re,disabled:M,children:M?"Modification...":"Changer le mot de passe"})})]})]})]})})}export{_r as default};
