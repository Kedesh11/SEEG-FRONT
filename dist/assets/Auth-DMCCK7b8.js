import{r as a,j as e,B as o,A as F,C as A,c as W,d as G,e as R,L as K,b as h,u as me,f as ue,a as xe,g as he,m as pe}from"./index-Dt07UTka.js";import{I as c}from"./input-Bw9vQiwZ.js";import{L as d}from"./label-5-3zOpNH.js";import{T as fe,a as je,b as te,c as re}from"./tabs-CneaFKhQ.js";import{C as le}from"./circle-check-big-DK0TIh3k.js";import{M as L}from"./mail-DxVkVQXW.js";import{B as ge,i as Ne}from"./launchGate-DNqG8lWI.js";import{u as ve}from"./useBackendAuth-DCuf5k9n.js";import{L as B}from"./lock-BPtVP7Qp.js";import{E as $}from"./eye-off-CYo70Vkr.js";import{E as H}from"./eye-BrJFRD8F.js";import{C as be}from"./circle-alert-BJk9C7zG.js";import"./index-DmmJ9r5k.js";import"./index-lOYlu7e4.js";function we({onBack:m,embedded:E=!0}){const[g,p]=a.useState(""),[u,w]=a.useState(!1),[I,M]=a.useState(!1),[r,y]=a.useState(0),k="pw_reset_cooldown_ts",N=60,T=l=>{const n=Date.now()+l*1e3;try{localStorage.setItem(k,String(n))}catch{}y(l)},V=a.useRef(!1);a.useEffect(()=>{try{const l=localStorage.getItem(k),n=l?Number(l):0,v=n&&Number.isFinite(n)?Math.max(0,Math.ceil((n-Date.now())/1e3)):0;v>0&&r===0&&y(v),V.current=v>0}catch{}if(r>0){const l=setTimeout(()=>y(r-1),1e3);return()=>clearTimeout(l)}},[r]);const C=async l=>{if(l.preventDefault(),!g.trim()){h.error("Veuillez saisir votre adresse email");return}if(!(r>0)){w(!0);try{M(!0),h.info("La réinitialisation de mot de passe sera bientôt disponible."),T(N)}catch(n){const v=n instanceof Error?n.message:"Une erreur inconnue s'est produite";h.error("Une erreur s'est produite: "+v)}finally{w(!1)}}};return I?E?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(le,{className:"w-5 h-5 text-green-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Demande enregistrée"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["Nous vous enverrons un lien à ",e.jsx("strong",{children:g})," dès que la fonctionnalité sera activée."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{variant:"outline",className:"w-full h-10",onClick:()=>{M(!1),p("")},children:"Renvoyer la demande"}),e.jsxs(o,{variant:"ghost",className:"w-full h-10",onClick:m,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Retour à la connexion"]})]})]}):e.jsx("div",{className:"h-screen overflow-hidden bg-gradient-to-br from-blue-50 via-white to-blue-100 flex items-center justify-center p-3",children:e.jsxs(A,{className:"w-full max-w-sm shadow-lg border-0 bg-white/90 backdrop-blur-sm",children:[e.jsxs(W,{className:"text-center space-y-3 py-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(le,{className:"w-6 h-6 text-green-600"})}),e.jsx(G,{className:"text-xl font-semibold text-gray-900",children:"Demande enregistrée"})]}),e.jsxs(R,{className:"space-y-4 py-0",children:[e.jsx("div",{className:"text-center space-y-2",children:e.jsxs("p",{className:"text-gray-600 text-sm",children:["Nous vous enverrons un lien à ",e.jsx("strong",{children:g})," dès activation."]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{variant:"outline",className:"w-full h-10",onClick:()=>{M(!1),p("")},children:"Renvoyer la demande"}),e.jsxs(o,{variant:"ghost",className:"w-full h-10",onClick:m,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Retour à la connexion"]})]})]})]})}):E?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(L,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Mot de passe oublié"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Saisissez votre adresse email pour demander un lien."})]}),e.jsxs("form",{onSubmit:C,className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"email",className:"text-sm",children:"Adresse email"}),e.jsx(c,{id:"email",type:"email",placeholder:"votre.email@exemple.com",value:g,onChange:l=>p(l.target.value),required:!0,disabled:u||r>0,className:"h-10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{type:"submit",className:"w-full h-10",disabled:u||r>0,children:u?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),"Envoi..."]}):r>0?`Réessayez dans ${r}s`:e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Envoyer la demande"]})}),e.jsxs(o,{type:"button",variant:"ghost",className:"w-full h-10",onClick:m,disabled:u||r>0,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Retour à la connexion"]})]})]})]}):e.jsx("div",{className:"h-screen overflow-hidden bg-gradient-to-br from-blue-50 via-white to-blue-100 flex items-center justify-center p-3",children:e.jsxs(A,{className:"w-full max-w-sm shadow-lg border-0 bg-white/90 backdrop-blur-sm",children:[e.jsxs(W,{className:"text-center space-y-3 py-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto",children:e.jsx(L,{className:"w-6 h-6 text-blue-600"})}),e.jsx(G,{className:"text-xl font-semibold text-gray-900",children:"Mot de passe oublié"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Saisissez votre adresse email pour demander un lien."})]}),e.jsx(R,{className:"py-0",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(d,{htmlFor:"email",className:"text-sm",children:"Adresse email"}),e.jsx(c,{id:"email",type:"email",placeholder:"votre.email@exemple.com",value:g,onChange:l=>p(l.target.value),required:!0,disabled:u||r>0,className:"h-10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{type:"submit",className:"w-full h-10",disabled:u||r>0,children:u?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),"Envoi..."]}):r>0?`Réessayez dans ${r}s`:e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Envoyer la demande"]})}),e.jsxs(o,{type:"button",variant:"ghost",className:"w-full h-10",onClick:m,disabled:u||r>0,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Retour à la connexion"]})]})]})})]})})}function Ve(){var se;const m=me(),E=ue(),{isLoading:g,beToken:p}=xe(),{login:u,verifyMatricule:w}=ve(),[I,M]=a.useState("signin"),[r,y]=a.useState(!1),[k,N]=a.useState(!1),[T,V]=a.useState(0),[C,l]=a.useState(!1),[n,v]=a.useState(!1),[z,ie]=a.useState(!1),i=Ne(),Y=a.useRef(0),q=()=>{const s=Date.now();s-Y.current>1200&&(h.info("Les inscriptions seront disponibles à partir du lundi 25 août 2025."),Y.current=s)},ne=new URLSearchParams(E.search),J=((se=E.state)==null?void 0:se.redirect)||ne.get("redirect"),Q=a.useRef(0);a.useEffect(()=>{if(T>0){const s=setTimeout(()=>V(T-1),1e3);return()=>clearTimeout(s)}},[T]);const[S,X]=a.useState({email:"",password:""}),[t,b]=a.useState({email:"",password:"",confirmPassword:"",firstName:"",lastName:"",phone:"",matricule:""}),[O,f]=a.useState(""),[D,j]=a.useState(!1),[oe,Z]=a.useState(!1),[ye,U]=a.useState("");a.useEffect(()=>{j(!1),f(""),U("")},[t.matricule]);const ee=a.useCallback(async()=>{const s=t.matricule.trim();if(!s)return f("Le matricule est requis."),j(!1),!1;try{if(Z(!0),p&&p.length>0)try{const x=await w();return x!=null&&x.valid?(f(""),j(!0),U(s),!0):(f((x==null?void 0:x.reason)||"Matricule non valide."),j(!1),!1)}catch{return f("Erreur lors de la vérification du matricule."),j(!1),!1}return/^\d+$/.test(s)?(f(""),j(!0),U(s),!0):(f("Le matricule doit contenir uniquement des chiffres."),j(!1),!1)}catch{return f("Erreur lors de la vérification du matricule."),j(!1),!1}finally{Z(!1)}},[t.matricule,p,w]);a.useEffect(()=>{if(!t.matricule)return;const s=setTimeout(()=>{ee()},1e3);return()=>clearTimeout(s)},[t.matricule,ee]);const ce=async s=>{s.preventDefault(),N(!0);try{if(!await u(S.email,S.password)){h.error("Email ou mot de passe incorrect.");return}try{await w()}catch{}const ae=Date.now();if(ae-Q.current>1500&&(h.success("Connexion réussie !"),Q.current=ae),J){m(J);return}try{const _=await pe(),P=String((_==null?void 0:_.role)??"").toLowerCase();m(P==="admin"?"/admin/dashboard":P==="recruiter"||P==="observateur"||P==="observer"||P==="recruteur"?"/recruiter/dashboard":"/candidate/dashboard");return}catch{m("/candidate/dashboard")}}catch{h.error("Une erreur est survenue lors de la connexion")}finally{N(!1)}},de=async s=>{if(s.preventDefault(),N(!0),i){h.info("Les inscriptions seront disponibles à partir du lundi 25 août 2025."),N(!1);return}h.info("Les inscriptions sont temporairement désactivées."),N(!1)};return g?e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 text-white py-4 sm:py-6",children:e.jsxs("div",{className:"container mx-auto px-3 sm:px-4",children:[e.jsx(he,{to:"/",children:e.jsxs(o,{variant:"ghost",className:"mb-3 sm:mb-4 text-blue-600 bg-white text-xs sm:text-sm",children:[e.jsx(F,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Retour à l'accueil"}),e.jsx("span",{className:"sm:hidden",children:"Retour"})]})}),e.jsxs("div",{className:"text-center space-y-2 sm:space-y-3 lg:space-y-4",children:[e.jsxs("div",{className:"inline-block bg-white/10 backdrop-blur-sm rounded-full px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm",children:[e.jsx(ge,{className:"w-3 h-3 sm:w-4 sm:h-4 inline mr-1 sm:mr-2"}),"Plateforme OneHCM | Talent source"]}),e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl xl:text-4xl font-bold",children:"Accès à votre compte"}),e.jsx("p",{className:"text-xs sm:text-sm lg:text-base xl:text-lg opacity-90 max-w-2xl mx-auto px-2 sm:px-4 leading-relaxed",children:"Connectez-vous ou créez votre compte pour accéder à la plateforme de recrutement SEEG"})]})]})}),e.jsx("div",{className:"container mx-auto px-3 sm:px-4 py-4 sm:py-6 lg:py-8",children:e.jsx("div",{className:"max-w-sm sm:max-w-md mx-auto",children:e.jsxs(A,{className:"shadow-xl border-0 bg-white/80 backdrop-blur-sm",children:[e.jsx(W,{className:"text-center pb-4 sm:pb-6",children:e.jsx(G,{className:"text-lg sm:text-xl lg:text-2xl font-bold",children:"Authentification"})}),e.jsx(R,{className:"px-4 sm:px-6",children:r?e.jsx(we,{onBack:()=>y(!1)}):e.jsxs(fe,{value:I,onValueChange:s=>{if(s==="signup"){i&&q();return}M(s)},className:"w-full",children:[e.jsxs(je,{className:"grid w-full grid-cols-2",children:[e.jsx(te,{value:"signin",children:"Connexion"}),e.jsx(te,{value:"signup",onClick:s=>{s.preventDefault(),s.stopPropagation(),i&&q()},disabled:!0,className:"opacity-50 cursor-not-allowed pointer-events-auto",title:i?"Inscriptions indisponibles jusqu'au 25 août 2025":"",children:"Inscription"})]}),e.jsx(re,{value:"signin",children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"signin-email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{id:"signin-email",type:"email",placeholder:"votre.email@exemple.com",value:S.email,onChange:s=>X({...S,email:s.target.value}),className:"pl-10",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"signin-password",children:"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{id:"signin-password",type:C?"text":"password",placeholder:"Votre mot de passe",value:S.password,onChange:s=>X({...S,password:s.target.value}),className:"pl-10 pr-10",required:!0}),e.jsx("button",{type:"button","aria-label":C?"Masquer le mot de passe":"Afficher le mot de passe",onClick:()=>l(s=>!s),className:"absolute right-3 top-2.5 text-muted-foreground hover:text-foreground",children:C?e.jsx($,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"text-right text-sm",children:e.jsx(o,{type:"button",variant:"link",className:"p-0 h-auto font-normal",onClick:()=>y(!0),children:"Mot de passe oublié ?"})}),e.jsx(o,{type:"submit",className:"w-full",disabled:k,children:k?"Connexion...":"Se connecter"})]})}),e.jsx(re,{value:"signup",children:e.jsxs("div",{className:"relative",children:[i&&e.jsx("div",{className:"absolute inset-0 z-10 cursor-not-allowed",onClick:q,"aria-hidden":"true"}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"firstName",className:"text-sm",children:"Prénom"}),e.jsx(c,{id:"firstName",placeholder:"Prénom",value:t.firstName,onChange:s=>b({...t,firstName:s.target.value}),className:"text-sm",required:!0,disabled:i})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"lastName",className:"text-sm",children:"Nom"}),e.jsx(c,{id:"lastName",placeholder:"Nom",value:t.lastName,onChange:s=>b({...t,lastName:s.target.value}),className:"text-sm",required:!0,disabled:i})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"signup-email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{id:"signup-email",type:"email",placeholder:"votre.email@exemple.com",value:t.email,onChange:s=>b({...t,email:s.target.value}),className:"pl-10",required:!0,disabled:i})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"matricule",children:"Matricule"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{id:"matricule",placeholder:"Ex: 1234",title:"Le matricule ne doit contenir que des chiffres.",value:t.matricule,onChange:s=>b({...t,matricule:s.target.value}),required:!0,className:O?"border-destructive":D?"border-green-500":"",disabled:i}),oe&&e.jsx(K,{className:"absolute right-3 top-3 h-4 w-4 animate-spin text-muted-foreground"})]}),O&&e.jsx(A,{className:"border-red-200 bg-red-50",children:e.jsxs(R,{className:"py-3 flex items-start gap-2 text-red-700",children:[e.jsx(be,{className:"w-4 h-4 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Vérification du matricule"}),e.jsx("p",{className:"text-sm",children:O})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phone",children:"Téléphone"}),e.jsx(c,{id:"phone",type:"tel",placeholder:"+241 01 23 45 67",value:t.phone,onChange:s=>b({...t,phone:s.target.value}),disabled:i||!D,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"signup-password",children:"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{id:"signup-password",type:n?"text":"password",placeholder:"Mot de passe (min. 6 caractères)",value:t.password,onChange:s=>b({...t,password:s.target.value}),className:"pl-10 pr-10",required:!0,disabled:i||!D}),e.jsx("button",{type:"button","aria-label":n?"Masquer le mot de passe":"Afficher le mot de passe",onClick:()=>v(s=>!s),className:"absolute right-3 top-2.5 text-muted-foreground hover:text-foreground",disabled:i,children:n?e.jsx($,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirmPassword",children:"Confirmer le mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(c,{id:"confirmPassword",type:z?"text":"password",placeholder:"Confirmez votre mot de passe",value:t.confirmPassword,onChange:s=>b({...t,confirmPassword:s.target.value}),className:"pl-10 pr-10",required:!0,disabled:i||!D}),e.jsx("button",{type:"button","aria-label":z?"Masquer le mot de passe":"Afficher le mot de passe",onClick:()=>ie(s=>!s),className:"absolute right-3 top-2.5 text-muted-foreground hover:text-foreground",disabled:i,children:z?e.jsx($,{className:"h-4 w-4"}):e.jsx(H,{className:"h-4 w-4"})})]})]}),e.jsx(o,{type:"submit",className:"w-full opacity-50 cursor-not-allowed pointer-events-none",disabled:!0,onClick:s=>{s.preventDefault(),s.stopPropagation(),i&&q()},children:"Inscriptions closes"})]})]})})]})})]})})})]})}export{Ve as default};
