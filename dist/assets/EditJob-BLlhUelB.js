import{l as V,u as Z,k as H,r as y,j as e,L as w,g as L,B as v,A as J,C as W,c as P,d as Q,e as K}from"./index-Dt07UTka.js";import{R as I}from"./RecruiterLayout-CzqFpArC.js";import{I as D}from"./input-Bw9vQiwZ.js";import{L as h}from"./label-5-3zOpNH.js";import{S as U,a as F,b as q,c as O,d as u}from"./select-B2MghH9c.js";import{R as E}from"./quill.snow-CAKySR-3.js";import{A as X,a as ee,b as te,c as se,d as re,e as ie,f as ae,g as ne,h as oe}from"./alert-dialog-DaOPzWw8.js";import{a as le}from"./useJobOffers-BrDiClz1.js";import{a as ce}from"./isEqual-XG_EwNFo.js";import{m as B,a as z}from"./en-US-Dy1UnLtf.js";import{T as de}from"./trash-2-BDEO4a2-.js";import{S as me}from"./save-Dp_vy41W.js";import{f as _}from"./format-BbOC2X4i.js";import"./sidebar-DQHe9abK.js";import"./separator-CPOmk9ej.js";import"./index-CnKgKWfo.js";import"./Combination-aU0zapuW.js";import"./layout-dashboard-CftRPHET.js";import"./users-BSixSwM-.js";import"./brain-BM1gby9g.js";import"./briefcase-DGZDCsL0.js";import"./user-ix4zyo1H.js";import"./log-out-C2CngwNs.js";import"./index-Cr6IkeUt.js";import"./index-BdQq_4o_.js";import"./index-lOYlu7e4.js";import"./index-CUAMUldx.js";import"./useQuery-BeOx6H6z.js";import"./useMutation-DLLhhcgk.js";function G(r,s){const i=fe(r);let t;if(i.date){const c=xe(i.date,2);t=ge(c.restDateString,c.year)}if(!t||isNaN(t.getTime()))return new Date(NaN);const m=t.getTime();let f=0,x;if(i.time&&(f=je(i.time),isNaN(f)))return new Date(NaN);if(i.timezone){if(x=ve(i.timezone),isNaN(x))return new Date(NaN)}else{const c=new Date(m+f),g=new Date(0);return g.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),g.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),g}return new Date(m+f+x)}const C={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},ue=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,pe=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,he=/^([+-])(\d{2})(?::?(\d{2}))?$/;function fe(r){const s={},a=r.split(C.dateTimeDelimiter);let i;if(a.length>2)return s;if(/:/.test(a[0])?i=a[0]:(s.date=a[0],i=a[1],C.timeZoneDelimiter.test(s.date)&&(s.date=r.split(C.timeZoneDelimiter)[0],i=r.substr(s.date.length,r.length))),i){const t=C.timezone.exec(i);t?(s.time=i.replace(t[1],""),s.timezone=t[1]):s.time=i}return s}function xe(r,s){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),i=r.match(a);if(!i)return{year:NaN,restDateString:""};const t=i[1]?parseInt(i[1]):null,m=i[2]?parseInt(i[2]):null;return{year:m===null?t:m*100,restDateString:r.slice((i[1]||i[2]).length)}}function ge(r,s){if(s===null)return new Date(NaN);const a=r.match(ue);if(!a)return new Date(NaN);const i=!!a[4],t=N(a[1]),m=N(a[2])-1,f=N(a[3]),x=N(a[4]),c=N(a[5])-1;if(i)return Ce(s,x,c)?De(s,x,c):new Date(NaN);{const g=new Date(0);return!be(s,m,f)||!ye(s,t)?new Date(NaN):(g.setUTCFullYear(s,m,Math.max(t,f)),g)}}function N(r){return r?parseInt(r):1}function je(r){const s=r.match(pe);if(!s)return NaN;const a=M(s[1]),i=M(s[2]),t=M(s[3]);return Te(a,i,t)?a*B+i*z+t*1e3:NaN}function M(r){return r&&parseFloat(r.replace(",","."))||0}function ve(r){if(r==="Z")return 0;const s=r.match(he);if(!s)return 0;const a=s[1]==="+"?-1:1,i=parseInt(s[2]),t=s[3]&&parseInt(s[3])||0;return Se(i,t)?a*(i*B+t*z):NaN}function De(r,s,a){const i=new Date(0);i.setUTCFullYear(r,0,4);const t=i.getUTCDay()||7,m=(s-1)*7+a+1-t;return i.setUTCDate(i.getUTCDate()+m),i}const Ne=[31,null,31,30,31,30,31,31,30,31,30,31];function R(r){return r%400===0||r%4===0&&r%100!==0}function be(r,s,a){return s>=0&&s<=11&&a>=1&&a<=(Ne[s]||(R(r)?29:28))}function ye(r,s){return s>=1&&s<=(R(r)?366:365)}function Ce(r,s,a){return s>=1&&s<=53&&a>=0&&a<=6}function Te(r,s,a){return r===24?s===0&&a===0:a>=0&&a<60&&s>=0&&s<60&&r>=0&&r<25}function Se(r,s){return s>=0&&s<=59}function rt(){const{id:r}=V(),s=Z(),{toast:a}=H(),i=le(r),t=i.data,m=i.isLoading,f=i.error,{updateJobOffer:x,isUpdating:c,deleteJobOffer:g,isDeleting:b}=ce(),[o,T]=y.useState({title:"",location:"",contractType:"",categorieMetier:"",dateLimite:"",reportingLine:"",jobGrade:"",salaryNote:"",startDate:"",responsibilities:"",requirements:""});y.useEffect(()=>{console.log("[EditJob DEBUG] FormData state updated:",o)},[o]),y.useEffect(()=>{if(t){console.log("[EditJob DEBUG] JobOffer data received:",t),console.log("[EditJob DEBUG] responsibilities type:",typeof t.responsibilities,t.responsibilities),console.log("[EditJob DEBUG] requirements type:",typeof t.requirements,t.requirements),console.log("[EditJob DEBUG] description:",t.description),console.log("[EditJob DEBUG] profile:",t.profile);const n=t.description&&t.description.trim()!==""?t.description:Array.isArray(t.responsibilities)?`<ul>${t.responsibilities.map(l=>`<li>${l}</li>`).join("")}</ul>`:t.responsibilities||"",p=t.profile&&t.profile.trim()!==""?t.profile:Array.isArray(t.requirements)?`<ul>${t.requirements.map(l=>`<li>${l}</li>`).join("")}</ul>`:t.requirements||"";console.log("[EditJob DEBUG] Final responsibilities content:",n),console.log("[EditJob DEBUG] Final requirements content:",p),T({title:t.title||"",location:Array.isArray(t.location)?t.location[0]||"":t.location||"",contractType:t.contract_type||"",responsibilities:n,requirements:p,reportingLine:t.reporting_line||"",jobGrade:t.job_grade||"",salaryNote:t.salary_note||"",categorieMetier:t.categorie_metier||"",startDate:t.start_date?_(G(t.start_date),"yyyy-MM-dd"):"",dateLimite:t.date_limite?_(G(t.date_limite),"yyyy-MM-dd"):""})}},[t]);const k=async n=>{if(n.preventDefault(),!r)return;const p={title:o.title,location:o.location,contract_type:o.contractType,description:o.responsibilities,profile:o.requirements,categorie_metier:o.categorieMetier||null,date_limite:o.dateLimite?new Date(o.dateLimite).toISOString():null,reporting_line:o.reportingLine||null,job_grade:o.jobGrade||null,salary_note:o.salaryNote||null,start_date:o.startDate?new Date(o.startDate).toISOString():null};try{if(typeof r!="string"){console.error("L'ID de l'offre est invalide.");return}await x({jobId:r,jobData:p}),a({title:"Offre modifiée",description:"L'offre d'emploi a été mise à jour avec succès.",variant:"default"}),s("/recruiter")}catch(l){const S=(()=>{try{return JSON.stringify(l)}catch{return String(l)}})();console.error("[EditJob] Update error:",l,S);const d=l,$=[d==null?void 0:d.message,d==null?void 0:d.details,d==null?void 0:d.hint,d==null?void 0:d.code].filter(Boolean).join(" | ")||(l instanceof Error?l.message:typeof l=="string"?l:S);a({title:"Erreur de mise à jour",description:$||"Une erreur est survenue. Veuillez réessayer.",variant:"destructive"})}},Y=()=>{if(typeof r!="string"){console.error("ID d'offre invalide pour la suppression",r);return}g({jobId:r,onSuccess:()=>{a({title:"Offre supprimée",description:"L'offre d'emploi a été supprimée avec succès.",variant:"default"}),s("/recruiter")},onError:n=>{const p=(()=>{try{return JSON.stringify(n)}catch{return String(n)}})();console.error("[EditJob] Delete error:",n,p);const l=n,d=[l==null?void 0:l.message,l==null?void 0:l.details,l==null?void 0:l.hint,l==null?void 0:l.code].filter(Boolean).join(" | ")||(n instanceof Error?n.message:typeof n=="string"?n:p);a({title:"Erreur de suppression",description:d||"Une erreur est survenue. Veuillez réessayer.",variant:"destructive"})}})},j=(n,p)=>{T(l=>({...l,[n]:p}))},A=(n,p)=>{T(l=>({...l,[n]:p}))};return m?e.jsx(I,{children:e.jsx("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center",children:e.jsx(w,{className:"w-8 h-8 animate-spin text-primary"})})}):f||!t?e.jsx(I,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-4",children:"Offre non trouvée"}),e.jsx(L,{to:"/recruiter",children:e.jsxs(v,{variant:"outline",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Retour au tableau de bord"]})})]})})}):e.jsx(I,{children:e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4 mb-6 sm:mb-8",children:[e.jsx(L,{to:"/recruiter",children:e.jsx(v,{variant:"outline",size:"icon",className:"h-8 w-8 sm:h-10 sm:w-10",children:e.jsx(J,{className:"w-3 h-3 sm:w-4 sm:h-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-foreground leading-tight",children:"Modifier l'offre d'emploi"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Modifiez les détails de votre offre d'emploi"})]})]}),e.jsxs(W,{className:"max-w-4xl",children:[e.jsx(P,{className:"p-4 sm:p-6",children:e.jsx(Q,{className:"text-base sm:text-lg",children:"Informations de l'offre"})}),e.jsx(K,{className:"p-4 sm:p-6",children:e.jsxs("form",{onSubmit:k,className:"space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"title",className:"text-sm sm:text-base",children:"Intitulé du poste *"}),e.jsx(D,{id:"title",value:o.title,onChange:n=>j("title",n.target.value),placeholder:"Ex: Développeur Full-Stack",required:!0,className:"text-sm sm:text-base"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"reportingLine",className:"text-sm sm:text-base",children:"Ligne hiérarchique directe"}),e.jsx(D,{id:"reportingLine",value:o.reportingLine,onChange:n=>j("reportingLine",n.target.value),placeholder:"Ex: Chef de Département Support",className:"text-sm sm:text-base"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"contractType",className:"text-sm sm:text-base",children:"Type de contrat *"}),e.jsxs(U,{value:o.contractType,onValueChange:n=>j("contractType",n),required:!0,children:[e.jsx(F,{className:"text-sm sm:text-base",children:e.jsx(q,{placeholder:"Type de contrat"})}),e.jsxs(O,{children:[e.jsx(u,{value:"CDI avec période d'essai",children:"CDI avec période d'essai"}),e.jsx(u,{value:"CDI",children:"CDI (Contrat à Durée Indéterminée)"}),e.jsx(u,{value:"CDD",children:"CDD (Contrat à Durée Déterminée)"}),e.jsx(u,{value:"Stage",children:"Stage"}),e.jsx(u,{value:"Freelance",children:"Freelance"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"categorieMetier",children:"Catégorie *"}),e.jsxs(U,{value:o.categorieMetier,onValueChange:n=>j("categorieMetier",n),required:!0,children:[e.jsx(F,{children:e.jsx(q,{placeholder:"Choisir une catégorie"})}),e.jsxs(O,{children:[e.jsx(u,{value:"Cadre",children:"Cadre"}),e.jsx(u,{value:"Cadre directeur",children:"Cadre de Direction "})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"salaryNote",children:"Salaire brut"}),e.jsx(D,{id:"salaryNote",value:o.salaryNote,onChange:n=>j("salaryNote",n.target.value),placeholder:"Ex: Selon grille salariale SEEG"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"startDate",children:"Date d'embauche"}),e.jsx(D,{id:"startDate",type:"date",value:o.startDate,onChange:n=>j("startDate",n.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"location",children:"Lieu de travail *"}),e.jsxs(U,{value:o.location,onValueChange:n=>j("location",n),required:!0,children:[e.jsx(F,{children:e.jsx(q,{placeholder:"Choisir une ville"})}),e.jsxs(O,{children:[e.jsx(u,{value:"Libreville",children:"Libreville"}),e.jsx(u,{value:"Port-Gentil",children:"Port-Gentil"}),e.jsx(u,{value:"Franceville",children:"Franceville"}),e.jsx(u,{value:"Oyem",children:"Oyem"}),e.jsx(u,{value:"Moanda",children:"Moanda"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"dateLimite",children:"Date limite de candidature"}),e.jsx(D,{id:"dateLimite",type:"date",value:o.dateLimite,onChange:n=>j("dateLimite",n.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"responsibilities",children:"Missions principales *"}),e.jsx(E,{theme:"snow",value:o.responsibilities,onChange:n=>A("responsibilities",n),className:"bg-white quill-editor-container"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"requirements",children:"Connaissance savoir et requis *"}),e.jsx(E,{theme:"snow",value:o.requirements,onChange:n=>A("requirements",n),className:"bg-white quill-editor-container"})]}),e.jsxs("div",{className:"flex justify-between items-center gap-4 pt-6",children:[e.jsx("div",{children:e.jsxs(X,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(v,{variant:"destructive",className:"gap-2",disabled:b,children:[e.jsx(de,{className:"w-4 h-4"}),"Supprimer l'offre"]})}),e.jsxs(te,{children:[e.jsxs(se,{children:[e.jsx(re,{children:"Êtes-vous absolument sûr ?"}),e.jsx(ie,{children:`Cette action est irréversible. L'offre d'emploi sera marquée comme "fermée" et ne sera plus visible par les candidats.`})]}),e.jsxs(ae,{children:[e.jsx(ne,{children:"Annuler"}),e.jsx(oe,{onClick:Y,disabled:b,children:b?e.jsxs(y.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}),"Suppression..."]}):"Confirmer la suppression"})]})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(L,{to:"/recruiter",children:e.jsx(v,{variant:"outline",children:"Annuler"})}),e.jsxs(v,{type:"submit",variant:"hero",className:"gap-2",disabled:c||b||!o.title||!o.location||!o.contractType||!o.categorieMetier||!o.responsibilities||!o.requirements,children:[c?e.jsx(w,{className:"w-4 h-4 animate-spin"}):e.jsx(me,{className:"w-4 h-4"}),c?"Sauvegarde...":"Sauvegarder"]})]})]})]})})]})]})})}export{rt as default};
