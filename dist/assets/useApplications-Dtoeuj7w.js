import{u as y}from"./useQuery-BeOx6H6z.js";import{W as o,a2 as u,a1 as I,a as A,i as b}from"./index-Dt07UTka.js";import{u as w}from"./useMutation-DLLhhcgk.js";function m(t){return{id:String(t.id),jobOfferId:t.job_offer_id!==void 0?String(t.job_offer_id):void 0,candidateId:t.candidate_id!==void 0?String(t.candidate_id):void 0,status:t.status,createdAt:t.created_at,updatedAt:t.updated_at,referenceContacts:t.reference_contacts??null,availabilityStart:t.availability_start??null,mtpAnswers:t.mtp_answers??null}}async function f(t){var i;const n=I(u.APPLICATIONS.BASE,t),a=await o.get(n);return(Array.isArray((i=a.data)==null?void 0:i.data)?a.data.data:[]).map(m)}async function g(t){var e;const a=(e=(await o.get(u.APPLICATIONS.DETAIL(t))).data)==null?void 0:e.data;return a?m(a):null}async function L(t){var e;const a=(e=(await o.post(u.APPLICATIONS.BASE,t)).data)==null?void 0:e.data;return m(a)}async function T(t,n){var i;const e=(i=(await o.put(u.APPLICATIONS.DETAIL(t),n)).data)==null?void 0:i.data;return m(e)}async function q(t){const{data:n}=await o.get(`${u.APPLICATIONS.DETAIL(t)}/documents`);return(n==null?void 0:n.data)??[]}async function h(t,n){const a=new FormData;a.append("file",n);const{data:e}=await o.post(`${u.APPLICATIONS.DETAIL(t)}/documents`,a,{headers:{}});return e==null?void 0:e.data}async function E(t,n){const{status:a}=await o.delete(`${u.APPLICATIONS.DETAIL(t)}/documents/${encodeURIComponent(String(n))}`);return a===204}async function O(t,n){const a=`${u.APPLICATIONS.DETAIL(t)}/documents/${encodeURIComponent(String(n))}/download`,{data:e}=await o.get(a,{responseType:"blob"});return e}function p(t){return{id:t.id,job_offer_id:t.jobOfferId,candidate_id:t.candidateId,status:t.status??"candidature",created_at:t.createdAt,updated_at:t.updatedAt,reference_contacts:t.referenceContacts??null,availability_start:t.availabilityStart??null,mtp_answers:t.mtpAnswers??null}}function D(t){const{user:n}=A();return y({queryKey:["applicationStatus",n==null?void 0:n.id,t],queryFn:async()=>{if(!n||!t)return null;const e=(await f({candidate_id:n.id,job_offer_id:t,limit:1})||[])[0];return e?{id:e.id,status:e.status}:null},enabled:!!n&&!!t})}function N(){var d;const{user:t,isRecruiter:n,isAdmin:a}=A(),e=(d=A())==null?void 0:d.isObserver,i=b(),r=async()=>t?!n&&!a&&!e?(await f({candidate_id:t.id})).map(p):(await f()).map(p):[],s=y({queryKey:["applications",t==null?void 0:t.id],queryFn:r,enabled:!!t}),c=w({mutationFn:async l=>{if(!t)throw new Error("User not authenticated");const _={candidate_id:t.id,job_offer_id:l.job_offer_id,reference_contacts:l.ref_contacts??null,mtp_answers:l.mtp_answers??null},S=await L(_);return p(S)},onSuccess:()=>{i.invalidateQueries({queryKey:["applications",t==null?void 0:t.id]})}});return{applications:s.data??[],isLoading:s.isLoading,error:s.error,submitApplication:c.mutateAsync,refetch:s.refetch}}function R(t){var r;const{user:n,isRecruiter:a,isAdmin:e}=A(),i=(r=A())==null?void 0:r.isObserver;return y({queryKey:["application",t,n==null?void 0:n.id],queryFn:async()=>{if(!t||!n)return null;const s=await g(t);if(!s)return null;const c=p(s);return!a&&!e&&!i&&c.candidate_id!==n.id?null:c},enabled:!!t&&!!n,retry:1})}function F(t){const{user:n}=A(),a=b(),e=["recruiterApplications",n==null?void 0:n.id,t],r=y({queryKey:e,queryFn:async()=>n?(await f(t?{job_offer_id:t}:void 0)).map(p):[],enabled:!!n}),s=w({mutationFn:async({applicationId:c,status:d})=>{const l=await T(c,{status:String(d)});return p(l)},onSuccess:(c,{applicationId:d})=>{a.invalidateQueries({queryKey:e}),a.invalidateQueries({queryKey:["application",d],exact:!1})}});return{applications:r.data??[],isLoading:r.isLoading,error:r.error,updateApplicationStatus:s.mutateAsync,refetch:r.refetch}}export{N as a,R as b,h as c,E as d,F as e,O as g,q as l,D as u};
