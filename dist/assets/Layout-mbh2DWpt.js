import{h as O,W as y,Y as G,a as k,i as H,r as j,s as v,f as L,u as E,j as e,g as N,B as x,b as u}from"./index-Dt07UTka.js";import{B as z}from"./badge-BL2mfjTD.js";import{B as D,i as F}from"./launchGate-DNqG8lWI.js";import{P as q,a as Q,b as V}from"./popover-YAsM8h-6.js";import{f as W}from"./fr-CfdXjsD4.js";import{u as J}from"./useQuery-BeOx6H6z.js";import{u as R}from"./useMutation-DLLhhcgk.js";import{B as Y,f as K}from"./formatDistanceToNow-2oA28mCp.js";import{L as X}from"./log-out-C2CngwNs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=O("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=O("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),A=`${G}/notifications`;async function se(){const{data:s}=await y.get(`${A}/`);return(s==null?void 0:s.data)??[]}async function te(s){const{data:r}=await y.put(`${A}/${encodeURIComponent(String(s))}/read`,{});return(r==null?void 0:r.data)??null}async function ae(){const{status:s}=await y.put(`${A}/read-all`,{});return s===204}function re(){const{user:s}=k(),r=H(),i=["notifications",s==null?void 0:s.id],{data:h=[],isLoading:l,error:c}=J({queryKey:i,queryFn:async()=>s?(await se()||[]).filter(n=>String(n.user_id)===String(s.id)).sort((n,m)=>new Date(m.created_at).getTime()-new Date(n.created_at).getTime()).map(n=>({id:n.id,user_id:String(n.user_id),title:n.title,message:n.message,read:n.read,link:n.link??null,created_at:n.created_at})):[],enabled:!!s}),o=j.useMemo(()=>{var b,w;if(!s)return null;const a=(w=(b=import.meta)==null?void 0:b.env)==null?void 0:w.VITE_API_BASE_URL,m=(a&&typeof a=="string"?a:window.location.origin.replace(/\/$/,"")).replace(/^http:/i,"ws:").replace(/^https:/i,"wss:"),p=(()=>{try{return localStorage.getItem("hcm_access_token")}catch{return null}})();return p?`${m}/api/v1/notifications/ws?token=${encodeURIComponent(p)}`:null},[s]);j.useEffect(()=>{if(!o)return;let a=null;try{a=new WebSocket(o),a.onopen=()=>{},a.onmessage=n=>{try{const m=JSON.parse(n.data);switch((m==null?void 0:m.type)||""){case"notifications:unread_count":case"notifications:updated":case"notifications:updated_all":case"notifications:new":r.invalidateQueries({queryKey:i});break;default:break}}catch{}},a.onerror=()=>{}}catch{}return()=>{try{a==null||a.close()}catch{}}},[o,r,i]);const f=R({mutationFn:async a=>{s&&await te(a)},onSuccess:()=>{r.invalidateQueries({queryKey:i})}}),d=R({mutationFn:async()=>{s&&await ae()},onSuccess:()=>{r.invalidateQueries({queryKey:i})}});return{notifications:h,isLoading:l,error:c,unreadCount:h.filter(a=>!a.read).length,markAsRead:f.mutate,markAllAsRead:d.mutate}}const ne=async()=>{const s={tableAccess:!1,rpcAccess:!1,authStatus:!1,errors:[]};try{console.log("[DIAGNOSTIC] Testing job_offers table access...");const{data:r,error:i}=await v.from("job_offers").select("id").limit(1);i?(s.errors.push(`Table access failed: ${i.message}`),console.error("[DIAGNOSTIC] Table access failed:",i)):(s.tableAccess=!0,console.log("[DIAGNOSTIC] Table access successful:",r)),console.log("[DIAGNOSTIC] Testing RPC function access...");const{data:h,error:l}=await v.rpc("get_all_recruiter_applications");l?(s.errors.push(`RPC access failed: ${l.message}`),console.error("[DIAGNOSTIC] RPC access failed:",l)):(s.rpcAccess=!0,console.log("[DIAGNOSTIC] RPC access successful:",h)),console.log("[DIAGNOSTIC] Testing authentication status...");const{data:{user:c},error:o}=await v.auth.getUser();o?(s.errors.push(`Auth check failed: ${o.message}`),console.error("[DIAGNOSTIC] Auth check failed:",o)):(s.authStatus=!!c,console.log("[DIAGNOSTIC] Auth status:",{user:!!c,userId:c==null?void 0:c.id}))}catch(r){s.errors.push(`Unexpected error: ${r}`),console.error("[DIAGNOSTIC] Unexpected error:",r)}return console.log("[DIAGNOSTIC] Results:",s),s};function ie(){var S;L();const s=E(),{user:r,signOut:i,isRecruiter:h,isCandidate:l,isAdmin:c,refreshUserRole:o}=k(),{notifications:f,unreadCount:d,markAsRead:a,markAllAsRead:n}=re(),[m,p]=j.useState(!1),b=!!r,w=F(),_=()=>u.info("Les inscriptions seront disponibles à partir du lundi 25 août 2025."),[B,C]=j.useState(!1),[P,I]=j.useState(!1),M=async()=>{try{p(!1),await new Promise(g=>setTimeout(g,100));const{error:t}=await i();if(t){u.error("Erreur lors de la déconnexion");return}u.info("Déconnexion réussie. À bientôt !"),setTimeout(()=>{window.location.href="/"},500)}catch{u.error("Erreur lors de la déconnexion")}},$=async()=>{try{await o(),u.success("Rôle mis à jour !")}catch{u.error("Erreur lors de la mise à jour du rôle")}},U=async()=>{try{const t=await ne();console.log("Diagnostic results:",t),t.errors.length>0?(u.error(`Diagnostic: ${t.errors.length} erreur(s) détectée(s)`),console.error("Database diagnostic errors:",t.errors)):u.success("Diagnostic: Base de données accessible")}catch(t){u.error("Erreur lors du diagnostic"),console.error("Diagnostic failed:",t)}};return j.useEffect(()=>{const t=new Date,g=t.getHours(),T=t.getMinutes();g===18&&T>=0||g>18&&g<24||g===0&&T<=40?(C(!0),I(!1)):(C(!1),I(!0))},[]),e.jsx(e.Fragment,{children:e.jsxs("header",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:[B?e.jsx("div",{className:"bg-red-700 text-yellow-400 text-center mb-2",children:e.jsx("div",{className:"bg-white/10 py-2 px-4",children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-bold whitespace-nowrap",children:"MISE À JOUR :"}),e.jsx("span",{className:"text-white text-sm sm:text-base",children:"Une indisponibilité du site est prévue de 00h00 à 00h40"})]})})})}):P&&e.jsx("div",{className:"bg-red-700 text-yellow-400 text-center mb-2",children:e.jsx("div",{className:"bg-white/10 py-2 px-4",children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"font-bold whitespace-nowrap",children:"APPEL À CANDIDATURE CLÔTURÉ :"}),e.jsx("span",{className:"text-white text-sm sm:text-base",children:"La période de dépôt des candidatures est terminée. Merci pour votre intérêt."})]})})})}),e.jsxs("div",{className:"container mx-auto px-2 sm:px-4 h-14 sm:h-16 flex items-center justify-between",children:[e.jsx(N,{to:"/",className:"flex items-center hover:opacity-80 transition-opacity flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-lg overflow-hidden bg-white flex items-center justify-center",children:e.jsx("img",{src:"/LOGO HCM4.png",alt:"Logo",className:"w-full h-full object-contain"})})}),e.jsx("nav",{className:"flex items-center gap-1 sm:gap-2 md:gap-4",children:b?e.jsxs(e.Fragment,{children:[l&&e.jsxs("span",{className:"hidden md:block text-xs sm:text-sm text-muted-foreground truncate max-w-32",children:["Bonjour ",(S=r.user_metadata)==null?void 0:S.first_name]}),h&&e.jsx(N,{to:"/recruiter/dashboard",className:"hidden sm:block",children:e.jsx(x,{variant:"ghost",size:"sm",className:"text-xs sm:text-sm",children:"Espace Recruteurs"})}),e.jsxs(q,{open:m,onOpenChange:p,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(x,{variant:"ghost",size:"icon",className:"relative rounded-full",children:[e.jsx(Y,{className:"h-5 w-5"}),d>0&&e.jsx(z,{className:"absolute -top-1 -right-1 h-5 w-5 justify-center rounded-full p-0 text-xs",children:d})]})}),e.jsx(V,{className:"w-80",align:"end",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 px-2",children:[e.jsx("h4",{className:"font-medium",children:"Notifications"}),d>0&&e.jsx(x,{variant:"link",size:"sm",onClick:()=>n(),children:"Tout marquer comme lu"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:f.length>0?f.map(t=>e.jsx("div",{className:`p-2 rounded-lg mb-1 cursor-pointer transition-colors ${t.read?"hover:bg-muted":"bg-primary/10 hover:bg-primary/20"}`,onClick:()=>{t.read||a(t.id),t.link&&(s(t.link),p(!1))},children:e.jsxs("div",{className:"flex items-start",children:[!t.read&&e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary mr-3 mt-1.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-semibold text-sm",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.message}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:K(new Date(t.created_at),{addSuffix:!0,locale:W})})]})]})},t.id)):e.jsx("p",{className:"text-center text-sm text-muted-foreground py-4",children:"Aucune notification pour le moment."})})]})})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:$,className:"gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3",title:"Rafraîchir le rôle utilisateur",children:[e.jsx(D,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Actualiser"}),e.jsx("span",{className:"sm:hidden",children:"Actualiser"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:U,className:"gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3",children:[e.jsx(D,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Diagnostic"}),e.jsx("span",{className:"sm:hidden",children:"Diag"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:M,className:"gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3",children:[e.jsx(X,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Déconnexion"}),e.jsx("span",{className:"sm:hidden",children:"Sortir"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{to:"/auth",children:e.jsxs(x,{variant:"outline",size:"sm",className:"gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3",children:[e.jsx(Z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Se connecter"}),e.jsx("span",{className:"sm:hidden",children:"Connexion"})]})}),e.jsx("div",{onClick:t=>{t.preventDefault(),t.stopPropagation(),w&&_()},className:"pointer-events-auto",title:w?"Inscriptions indisponibles jusqu'au 25 août 2025":void 0,children:e.jsxs(x,{variant:"default",size:"sm",className:"gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-3 opacity-50 cursor-not-allowed pointer-events-none",disabled:!0,children:[e.jsx(ee,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"S'inscrire"}),e.jsx("span",{className:"sm:hidden",children:"Inscription"})]})})]})})]})]})})}function ce(){const s=E(),r=L(),{user:i,isCandidate:h,isRecruiter:l,isAdmin:c}=k(),o=d=>{var a;if(d.preventDefault(),i){if(c){s("/admin/dashboard");return}if(l){s("/recruiter/jobs");return}s("/candidate/jobs");return}r.pathname==="/"?(a=document.getElementById("job-list"))==null||a.scrollIntoView({behavior:"smooth"}):(s("/"),setTimeout(()=>{var n;return(n=document.getElementById("job-list"))==null?void 0:n.scrollIntoView({behavior:"smooth"})},50))},f=d=>{if(d.preventDefault(),!i){s("/auth");return}if(l||c){s("/recruiter/dashboard");return}s("/candidate/dashboard?view=dashboard")};return e.jsx("footer",{className:"bg-primary-dark text-white mt-16",children:e.jsxs("div",{className:"container mx-auto px-4 py-12",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-12 max-w-6xl mx-auto px-4 w-full",children:[e.jsxs("div",{className:"flex-1 min-w-[300px] space-y-2",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 flex items-center justify-center",children:e.jsx("img",{src:"/LOGO HCM WHITE.png",alt:"Logo OneHCM",className:"w-full h-full object-contain"})})}),e.jsx("p",{className:"text-sm text-white/90",children:"Plateforme de recrutement dédiée à la détection des talents pour créer une passerelle entre l'entreprise et ses potentiels internes."})]}),e.jsxs("div",{className:"flex-1 min-w-[200px] space-y-4 md:text-right",children:[e.jsx("h4",{className:"font-semibold text-white",children:"Liens rapides"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{to:"#",onClick:o,className:"block text-sm text-white/90 hover:text-white transition-colors",children:"Postes à pourvoir"}),e.jsx(N,{to:"#",onClick:f,className:"block text-[13px] sm:text-sm text-white/90 hover:text-white transition-colors",children:"Espace recruteurs"})]})]})]}),e.jsx("div",{className:"border-t border-white/20 mt-8 pt-8",children:e.jsx("div",{className:"text-center text-sm text-white/90",children:e.jsxs("p",{children:["© ",new Date().getFullYear()," OneHCM | Talent source. Tous droits réservés."]})})})]})})}function je({children:s,className:r="",showFooter:i=!1}){return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(ie,{}),e.jsx("main",{id:"main",tabIndex:-1,className:`flex-1 ${r}`,children:s}),i&&e.jsx(ce,{})]})}export{je as L,re as u};
